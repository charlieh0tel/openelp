project(openelp)
cmake_minimum_required(VERSION 2.7)

#
# Configuration Variables
#

if(NOT DEFINED BUILD_SHARED_LIBS)
  set(BUILD_SHARED_LIBS "on")
endif()

if(NOT DEFINED OPENELP_USE_OPENSSL)
  set(OPENELP_USE_OPENSSL false)
endif()

if(NOT DEFINED OPENELP_USE_SYSLOG)
  if(UNIX)
    set(OPENELP_USE_SYSLOG true)
  else()
    set(OPENELP_USE_SYSLOG false)
  endif()
endif()

if(NOT DEFINED SHARE_INSTALL_PREFIX)
  set(SHARE_INSTALL_PREFIX "${CMAKE_INSTALL_PREFIX}/share")
endif()

#
# Dependencies
#

if(OPENELP_USE_OPENSSL)
  find_package(OpenSSL REQUIRED)
endif()

#
# Variables
#

set(OPENELP_DOC_DIR "${CMAKE_CURRENT_SOURCE_DIR}/doc")
set(OPENELP_INCLUDE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/include")
set(OPENELP_SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/src")
set(OPENELP_TEST_DIR "${CMAKE_CURRENT_SOURCE_DIR}/test")

set(OPENELP_MAJOR_VERSION 0)
set(OPENELP_MINOR_VERSION 2)
set(OPENELP_PATCH_VERSION 0)
set(OPENELP_VERSION
  ${OPENELP_MAJOR_VERSION}.${OPENELP_MINOR_VERSION}.${OPENELP_PATCH_VERSION})

#
# Flags
#

set(CMAKE_C_FLAGS
  "${CMAKE_C_FLAGS} -DOPENELP_MAJOR_VERSION=${OPENELP_MAJOR_VERSION}")
set(CMAKE_C_FLAGS
  "${CMAKE_C_FLAGS} -DOPENELP_MINOR_VERSION=${OPENELP_MINOR_VERSION}")
set(CMAKE_C_FLAGS
  "${CMAKE_C_FLAGS} -DOPENELP_PATCH_VERSION=${OPENELP_PATCH_VERSION}")
set(CMAKE_C_FLAGS
  "${CMAKE_C_FLAGS} -DOPENELP_VERSION=${OPENELP_VERSION}")

if(OPENELP_USE_SYSLOG)
  set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -DHAVE_SYSLOG=1")
endif()

if(OPENELP_USE_OPENSSL)
  set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -DHAVE_OPENSSL=1")
endif()

if(UNIX)
  set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Wall")
else()
  set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} /W3 /WX /D_CRT_SECURE_NO_WARNINGS")
endif()

#
# Includes
#

include_directories(${OPENELP_INCLUDE_DIR} ${OPENELP_SOURCE_DIR})

if(OPENELP_USE_OPENSSL)
  include_directories(${OPENSSL_INCLUDE_DIRS})
endif()

#
# Link Dirs
#

if(OPENELP_USE_OPENSSL)
  link_directories(${OPENSSL_LIB_DIRS})
endif()

#
# Subdirs
#

add_subdirectory(${OPENELP_DOC_DIR})
add_subdirectory(${OPENELP_INCLUDE_DIR})
add_subdirectory(${OPENELP_SOURCE_DIR})
add_subdirectory(${OPENELP_TEST_DIR})
